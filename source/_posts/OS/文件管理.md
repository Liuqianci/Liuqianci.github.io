---
title: 文件管理
date: 2025-06-13 11:18:45
tags:
    - 操作系统
categories:
    - 操作系统
mathjax: true
---

# 文件的逻辑结构

## 文件类型

文件的逻辑结构根据文件类型可以分为两类：

1. 有结构文件：常见的有文本文件、文档、媒体文件等
2. 无结构文件：常见的有二进制文件、链接库等

&emsp;&emsp;有结构文件的文件内容由定长记录和可变长记录两部分组成。定长记录存储文件的格式、编码、文件描述等结构化数据项；可变长记录存储文件的具体内容。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-25_%E6%9C%89%E7%BB%93%E6%9E%84%E6%96%87%E4%BB%B6.png)

&emsp;&emsp;无结构文件也称为流式文件，文件内容长度以字节为单位。exe、dll、so文件都是无结构文件。

## 顺序文件

&emsp;&emsp;顺序文件是指按顺序存放在存储介质中的文件。磁带就是典型的顺序文件存储介质，只能按顺序读取和写入文件。顺序文件是所有逻辑文件当中存储效率最高的。

&emsp;&emsp;但由于顺序文件只能顺序读写，所以假如我们想要对文件内容进行增、删等操作，效率极其低下。

## 索引文件

&emsp;&emsp;可变长文件不适合适使用顺序文件格式存储，所以为了解决这个问题发明了索引文件。索引文件需要配合索引表完成存储的操作。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-26_%E7%B4%A2%E5%BC%95%E6%96%87%E4%BB%B6.png)

# 辅存(磁盘)的存储空间分配

## 分配方式

### 连续分配

&emsp;&emsp;如果一个文件存取的时候需要连续的扇区，就会把内存中连续的扇区分配给文件。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-27_%E8%BF%9E%E7%BB%AD%E5%88%86%E9%85%8D.png)

&emsp;&emsp;连续分配只要求我们顺序的读取文件即可，所以读取操作非常容易，速度很快。但是对存储要求很高，要求满足容量的连续存储空间。

### 链接分配

&emsp;&emsp;链接分配可以将文件存储在离散的盘块中，不再需要大块连续的存储空间，但需要额外的存储空间存储文件的盘块链接顺序。根据这个额外存储空间的不同，分为隐式链接和显式链接。

&emsp;&emsp;隐式链接的方法中，隐式分配的下一个链接存储在当前盘块内，就像链表结点中的next指针。隐式链接很适合顺序访问，我们只要知道起始的盘块就可以依次遍历所有的盘块，但是隐式链接的随机访问效率很低，必须从头开始寻找。并且隐式链接的可靠性差，任何一个链接出问题都将影响整个文件。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-28_%E9%9A%90%E5%BC%8F%E9%93%BE%E6%8E%A5.png)

&emsp;&emsp;显式链接就不在当前盘块中指定下一个盘块的位置了，而是单独有一张表，存储物理盘块以及下一个盘块的地址数据。这张表叫FAT(File Allocation Table)，也就是我们平时说的FAT文件系统，显式链接就是FAT系统的工作原理。FAT也存在一些缺点：它不支持高效的直接存储，因为FAT的记录项非常多，磁盘越大FAT记录越大，存储时需要检索FAT表找到空闲位置。而且检索FAT表时需要将整个FAT加载到内存中，占用较大的存储空间。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-29_%E6%98%BE%E5%BC%8F%E9%93%BE%E6%8E%A5.png)

### 索引分配

&emsp;&emsp;把文件的所有盘块集中存储，存储盘块的位置称为索引。每个文件都拥有一个索引块，记录当前文件所有盘块信息，当我们读取某个文件时，只需要读取索引即可，不需要把整张表都加载到内存中。通过索引分配我们可以直接找到文件对应的盘块。文件较大时，索引分配具有明显的优势。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-30_%E7%B4%A2%E5%BC%95%E5%88%86%E9%85%8D.png)

## 存储空间管理

### 空闲表

&emsp;&emsp;空闲表可以表示某个空闲的盘块号内有多少个空闲盘块数。空闲盘曲的分配与内存的分配类似，也具有首次适应算法、循环适应算法等；回收过程也和内存回收类似。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-31_%E7%A9%BA%E9%97%B2%E8%A1%A8.png)

### 空闲链表

&emsp;&emsp;空闲链表把所有空闲盘曲组成一个空闲链表，每个链表节点存储空闲盘块和空闲的数目。存储的信息和空闲表一样，操作方式也和内存的空闲链表方式类似。

### 位示图

&emsp;&emsp;位示图横向的是盘块，纵向的是磁道，每一个具体的盘块都有0或1的标记，0表示未使用，1表示已经被使用了。位示图优点很多，首先维护成本很低，只需要维护一张表即可；其次位示图可以非常容易的找到空闲盘块；位示图内部使用0/1比特位，占用的空间很小。

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-32_%E4%BD%8D%E7%A4%BA%E5%9B%BE.png)

# 目录管理

&emsp;&emsp;目录系统是树形结构存储，使得任何文件或目录都只有唯一路径

![](https://my-hexo-blog-1308129409.cos.ap-beijing.myqcloud.com/OS/mooc-33_%E7%9B%AE%E5%BD%95%E6%A0%91.png)